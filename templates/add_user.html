{% extends "base.html" %}

{% block title %}Add New User{% endblock %}

{% block extra_head %}
    <meta name="description" content="Create a new user account for the banking application, including setting an initial opening balance.">
    <meta name="keywords" content="add user, new user, banking, account creation">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/form.css') }}">
{% endblock %}

{% block content %}
    <div class="container">
        <div class="header">
            <h1>ðŸ‘¤ Add New User</h1>
            <p>Create a user account with opening balance</p>
        </div>

        <!-- Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <form method="post">
            <div class="form-group">
                <label for="first_name">First Name</label>
                <input type="text" id="first_name" name="first_name" required>
            </div>

            <div class="form-group">
                <label for="last_name">Last Name</label>
                <input type="text" id="last_name" name="last_name" required>
            </div>

            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" name="username" required>
            </div>

            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" required>
            </div>

            <div class="form-group">
                <label for="opening_balance">Opening Balance (Â£)</label>
                <input type="number" id="opening_balance" name="opening_balance" step="0.01" value="0.00" min="0">
            </div>

            <div class="info-box">
                <strong>What happens:</strong>
                <ul>
                    <li>âœ… A new user will be created</li>
                    <li>âœ… A current account will be set up for them</li>
                    <li>âœ… An opening balance transaction will be recorded (if > Â£0)</li>
                    <li>âœ… All existing transactions remain untouched</li>
                </ul>
            </div>

            <button type="submit" class="btn">Create User & Account</button>
            <a href="{{ url_for('dashboard') }}" class="btn-secondary">Cancel</a>
        </form>
    </div>
{% endblock %}

{% block extra_scripts %}
    <script>
        // Auto-generate username
        document.getElementById('first_name').addEventListener('input', updateUsername);
        document.getElementById('last_name').addEventListener('input', updateUsername);

        function updateUsername() {
            const firstName = document.getElementById('first_name').value.toLowerCase().trim();
            const lastName = document.getElementById('last_name').value.toLowerCase().trim();
            const usernameInput = document.getElementById('username');

            // Only auto-generate if the user hasn't typed their own username
            if (firstName && lastName && !usernameInput.value) {
                const sanitizedFirstName = firstName.replace(/[^a-z0-9]/g, '');
                const sanitizedLastName = lastName.replace(/[^a-z0-9]/g, '');
                usernameInput.value = sanitizedFirstName + '.' + sanitizedLastName;
            }
        }
    </script>
{% endblock %}
